<link href='http://fonts.googleapis.com/css?family=Press+Start+2P' rel='stylesheet' type='text/css'>
<script type="text/javascript" src="http://www.parsecdn.com/js/parse-1.2.19.min.js"></script>
<style>
  body {
    font-family: 'Press Start 2P', cursive;
    background-color: black;
    color: white;
    margin: 0;
    padding: 0;
  }
  .wall {
    background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAk0lEQVRYhWOom8vzv24uz//de1aQhGH6KNXPMOAOaMhy/t+Q5fx/ydRSkjDMIEr1jzpg5Dlg9+5lEDxiHTDgUTDqAKIdUJ/l9L8+y2kEOABWKcAMIhajV0bk6h88DhhtD5CaiA4dXPP/0ME1BBMhrOjFpX/4O4CQ/uHnAEIF2PB3wIBHwagDRh1AsgMGTXU8UA4AANEaiS8F8jfjAAAAAElFTkSuQmCC");
  }
  .container {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    overflow: hidden;
  }
  .board-container {
    position: absolute;
    left: 50%;
    top: 50%;
    margin-left: -16px;
    margin-top: -16px;
  }
  .row {}
  .ground {
    background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAhUlEQVRYhe3XwQ2AIAwF0JowL2ENZiCM5ghsgNa7CQG02C96+Oc+4KcJtO4La4Y+A7CB2AYCBrho2EXzOAQHUErKnlP2Ylfe3QE1wNXBvRBcwGjY+wDSg/EB0oupdAA8QOsCkYLgAaSepLW0+IC7ZaxB8AGjMzFgq2R+wCn4/wKt/AB1wAEpUF7eamflHQAAAABJRU5ErkJggg==");
  }
  .col {
    height: 32px;
    width: 32px;
    display: inline-block;
    position: relative;
    padding: 0px;
  }
  .player {
    height: 32px;
    width: 32px;
    display: inline-block;
    position: absolute;
    padding: 0px;
    left: 50%;
    top: 50%;
    margin-left: -16px;
    margin-top: -16px;
background: url(player.png);
  }
  .monster {
    height: 32px;
    width: 32px;
    display: inline-block;
    position: absolute;
    padding: 0px;
    left: 50%;
    top: 50%;
    margin-left: -16px;
    margin-top: -16px;
  }
  .player-battle-menu {

  }
  .player.flip {
    transform: scaleX(-1);
  }
  /*.player.down2 {
    background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABI0lEQVRYhd2WMQ6CQBBF5yS23sCEwph4Dq/BCewojIUxWlrYQ0E8ggkXsMXSA2hD8a2GZD8MgoawOMkvmJ2d/zLLEkTaB1qqtxgMACKC6DJFdJlCI8lnSPJZmVf1ATIYgDNaNbifJ42qAfkaaDAAiAge2RaPbFs2UIOaxo64jvuMF0AVLw6IFwfk0c2R5rl+vADZLkC2C8qNbPhJVp/xAfBorVFbdaMEcEC0kQYDsoFGDWjn8BtArxdfs78AgIjgtJ7jtJ5XRs7GLD4S7uM1gDPamo2OrJeQpX3afJL9ALAahukGYbrB8bVvlNZZwF4DOCBs/CxWeBarMq/PVt4CaTL2BqARxDoKXv/FeHAAiEjld/u6DByxAa/z/i4gfgD0KL8A3s+KVayXz5F2AAAAAElFTkSuQmCC");
  }*/
  .player.down1 {
    background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABHUlEQVRYhd2WMQrCQBBF5yS2uUEghQiew2vkBHYpxCJILC3stRCPIOQCtrH0ANqk+FYTmO+uGlGTdeAXGWbnv53dhYi8HnhRX4vOACAiyPYRsn0EjW0VY1vFTV71DZDOAMxo1eC0HjyUA+RtoM4AICI4l3Ocy3nTQA0cjY24jvuEC6DajApsRgWq7Gikea4PF6DME5R50ixkw2fy9QkPgEfrG7WvLkgAA6KNNBiQDTQcoK2j3wD6vPiZ/QUARASr6RCr6fBu5GzM4iPhPr0GMKN1LDTyXUJWeAC+huluhnQ3w/K6MNI8b+DBRvoLYEDY+FJPcKknTV6/Oc+XtY1xbwCcID4w31E4FA6AWag/mYdxYvQM8H8APqDW8VOAG5UxABRKRBbxAAAAAElFTkSuQmCC");
  }
  .player.left1 {
    background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAuElEQVRYhe3WvQ2AIBAFYCtjZWPBKG7gBsZBHMeKfaxch+JZURz+AYIcKsnrkPsMHKEo7AcCx3k8DiAfdFKhkwrNuHil7ifU/ZQHgBRM9ucpAFEKi3aAaAfegN3CdwEuW8ADYJtXAk5BQAmg3ED0wtHaMSWAQH7AUfSCrskCcFpAX61mbOfnB5hlReJ6ZXvvfUoAgRwBYrYfL4B5mGwB5uH8DsCcH6wb2AGuLp5g7wJ2gKsEfxnFBqxHQNXMWiTqmAAAAABJRU5ErkJggg==");
  }
  .player.left2 {
    background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAtElEQVRYhe3WOxJAMBAGYFVGpVE4ihu4gXEQx1HlPirXUfyqFBvx2HisRWb+LrKfSTYkyf6Bk8MetwPIA5UdUdkReTtEJas7ZHWnA0AKir25BOCSwkXZoCibZwOChY8COFvwDMDevBKwCgIMADODuIUva0dJAIH8gKW4BblRAVgt4K5Wl62C/nz9AO5VHb33kgAC6W1Kwv1IfRfgH1K9AL+dtgD+/NO6QT0g+r9AAhA8fK8FTBPE7gyybyNJAAAAAElFTkSuQmCC");
  }





  .player.right1 {
    background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABAElEQVRYhe2WMQqDQBBF5yRpvUFgixDwTp4gnYVYiMQyRfqkEI8g7AXSmtIL2E6qCcxGzeoadhby4Rfu6vzH7LAI8Nd34UKHD8AKku7dnjltIkybCJ/XHfMMkDWgNwAEgHdh8tLgLn0wzwAJBZgKpH3b4NvxzBwOgNl6Wu91jr3OP1o6Fbyk9WIARkFMAAqwCFx9MYUJQKL3daFQF8p9FnwAMBCzoAlCzyYArY8MbzgADIQAzNaaQeSRI1gtGQAOdpY3AFbocjow0/qWwyYGAAEA21hhGytrgM2HThwAOakzTOoMq6HEaih/MoQyACx+txkoeeY7+QCuF47zUXgBeAHRSHx5mxcmigAAAABJRU5ErkJggg==");
  }
  .player.right2 {
    background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABDklEQVRYhd3XsQ6CMBAG4HsSV96AhIGY+E48ARsDYSBERgZ3GQiPYNIXcMWRF2A9pyO5s5gCxYKX/AON9j5sbQDAvNAwm5UzAAIAUtWdj3XnY9J6mLQevm4nli1AzgAIAGMj08Zd8mRZA3EGYI0pNG7a+H6+ssCMpXEGQAAYf2oKjfcqw15lHxNZv3PnALnpJIAmlg01jdZtPhcALcQUQEWfV3mAKg8WgZwDGEROKCF0LQE0rtm8xwEwiARMNaJolmBx7QMgIfJaxkbjfQGqOMQqDr8dONYOot0AWGMJmPqblUOB5VD8ESBqUoyadBKgeRhl3z8+YG6sL4FLAIM8LgGLwQvJ8QGLlsAm5CeAN+xAcIH2fvhpAAAAAElFTkSuQmCC");
  }
  .player.right3 {
    background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABD0lEQVRYhe2WMQqDQBBFt7FNkz6tNwhsEQKCd0jrITxBOguxEIllivRJIR5B2AukNaUXsJ1UE5iNmtUVdhfy4ReuMv8xOwwy9tdvwUy7D0AKoh7tnjipfUhqH163HfEEkDKgMQBgjH0Ko+cGt8mTeALIUoCxQHyvGnw/XojdAZBbj+edyKAT2VdLx4LntN4agEEQGQADFAIXLyY3AVD4vcg5iJzrz4IJAAIiF5RB8FkGwPOB4XUHgIAggNxaOQg9cAWLZQeAhrVlDIAUup4PxHi+5rBZAwCMMWgCDk3AlQHWWDx2A6DjKoW4SqHsCyj7YnT4otCDKPSWb0DjAAq/28Sn7YbYSQDdhaO9mIwAvAFHZ3pd2gSfrgAAAABJRU5ErkJggg==");
  }
  .player.right4 {
    background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABDklEQVRYhd3XsQ6CMBAG4HsSV96AhIGY+E48ARsDYSBERgZ3GQiPYNIXcMWRF2A9pyO5s5gCxYKX/AON9j5sbQDAvNAwm5UzAAIAUtWdj3XnY9J6mLQevm4nli1AzgAIAGMj08Zd8mRZA3EGYI0pNG7a+H6+ssCMpXEGQAAYf2oKjfcqw15lHxNZv3PnALnpJIAmlg01jdZtPhcALcQUQEWfV3mAKg8WgZwDGEROKCF0LQE0rtm8xwEwiARMNaJolmBx7QMgIfJaxkbjfQGqOMQqDr8dONYOot0AWGMJmPqblUOB5VD8ESBqUoyadBKgeRhl3z8+YG6sL4FLAIM8LgGLwQvJ8QGLlsAm5CeAN+xAcIH2fvhpAAAAAElFTkSuQmCC");
  }




  .player.up1 {
    background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAA/UlEQVRYhe3UvQ2DMBAF4JuElg2QKGgyR9ZgAjoKRIGQKCkYgAIxQiRPQUoGCE2Kl+qQfMLhR0kcRznpFRb2+ZMBE+0vbMzbyhoARIS095H2Prh4zPkpgHakvEE7BGiHYAbwmLMAOQyyBgARYVQ5RpUbAaZIgOzzB7gDUEUIVYSbAXKeqY/7AJm1389JgAaR2Qs4srF1AIgIdRKhTqK5QdxliLts9ZWY1rsPqKYS1VSuQuT6wxeRdQCJo2eACSLn8/jwPWAToEG44e1+1iJBHH6+ANxd3wWQkaAnGzsOkJGQrR+nUwAQEa6Nh2vj4XIKtZhgG+IY4IXZXR8FPAC5iOxpcl6d3AAAAABJRU5ErkJggg==");
  }
  /*.player.up2 {
    background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAuklEQVRYhe3Vuw2AMAwE0CupaCgYhUlQBmEcKvahYiFTUSQ4cT4oJohIV2I/gWOA9EOeVDtqAAJAw3JY6eeV+nmtAlIDEAAaJ0PjZG4AF8KA2gUQgFthCRL4NI0DpIafAhQ1fgLyA9QBFqQUkNNYHcAuoKvgtYh8cV998QzUBDw6fDnD+APUAFGNY3/DOZA2AC5EuoY+8HsBqRB30fgSaPweAHsbpDCF2KSsZHWABYnNvnVsAs+IpyrgBJopbCQcWOipAAAAAElFTkSuQmCC");
  }*/
  .menu-item-selected {
    background-color: white;
    color: black;
    display: inline-block;
  }
  .map-item {
    cursor: pointer;
    color: blue;
  }
  .map-item:hover {
    color: p
  }
  .map-item.selected {
    font-weight: bold;
  }
  .player-cooldown-container {
    height: 10px;
    width: 120px;
    position: relative;
    border: white solid 2px;
    border-radius: 2px;
  }
  .player-cooldown {
    height: 10px;
    position: absolute;
    width: 0;
    background: linear-gradient(to bottom, #0F0 40%, #0C0 40%);
  }
  .player-status-container.hidden {
    display: none;
  }
  .dialog-container {
    position: absolute;
    left: 50%;
    top: 50%;
    margin-top: -160px;
    margin-left: -160px;
    width: 320px;
    height: 320px;
  }
  .dialog {
    border: white solid 2px;
    border-radius: 2px;
    padding: 4px;
    margin: 4px;
    left: 0;
    bottom: 0;
    position: absolute;
    background-color: black;
    z-index: 1;
  }
  .dialog.player-status-container {
    right: 0;
    bottom: auto;
  }
  .dialog.player-battle-menu {
    bottom: auto;
  }
  .map-list-container {
    position: absolute;
  }
</style>

<div class="container">

  <div class="dialog-container">
    <div class="player-status-container hidden dialog">
      <div>player health</div>
      <div class="player-health"></div>
      <div>player mana</div>
      <div class="player-mana"></div>
      <div class="player-cooldown-container">
        <div class="player-cooldown"></div>
      </div>
    </div>
  </div>
</div>
<div class="map-list-container">
  <div>existing maps</div>
  <div class="map-list"></div>
</div>
<script>
  Parse.initialize("rbzFxBKYWagwxXYmTXmZiQ2IrZOuiQXLEqpNhJoS", "vMPmzQLwkPcF4e0eDd0QwLAgAkG2DX67AgbK7NQQ");
  var data = [];

  var abilities = {
    "melee": {
      damage: 1,
      cost: 0
    },
    "fireball": {
      damage: 2,
      cost: 1
    },
    "heal": {
      damage: -2,
      cost: 1
    },
    "bite": {
      damage: 1,
      cost: 0
    },
    "shank": {
      damage: 1,
      cost: 0
    },
    "gruesome stare": {
      damage: 1,
      cost: 0
    }
  };

/*

  .player.right1 {
    background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAsklEQVRYhd3UPQ6AIAwFYEYnFwcP4uANuIHhIB7Hifs4eR2H50RM8I9SDa1Nuhj0fQGpMXvh5SaXDEA9TKiHCc24ZLX1K6xfs0DFAZ9ATkBKAG3v0PauCEQGgBt8BUiB6AaY4/UjD6xigKzgsD7+MNAB6EgD6feAx/oXgLL1sgDcERzeizsFUhzAOgrCEckHvALhBIsBkCA3P51eQNK1DM/DupNgfQBuMLtkAGZfkVotYANiolq846r7LgAAAABJRU5ErkJggg==");
  }
  .player.right2 {
    background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAyklEQVRYhd3UsQ2EMAwF0JRUNFcwCAUbsAFikBuHKvtQ3ToUn8o6YS5HnATZIdLvcPyUEDv3XSgc8bIBaKcF7bTg9f4kZfQbRr8lgdQBt0B+gCoBdMOMbphVIDYAuY1DgBhI3QB3fn7igaUGSGpM3/ONgR5ALxpIjwdcrmcBJEdvC5A7gqmOJwaiDsi6CsEV2QckQUocvRnA4fmEALwR/bwUvk8VgKhnyBuG6iirb7D6ptwcuAOQ1ZjXU6hxPQBecBUOiPju/91rAXbyx8oYAaB33AAAAABJRU5ErkJggg==");
  }
  .player.right3 {
    background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAzElEQVRYhd3UsQ2EMAwFUJdUNFcwCAUbsAFikBuHKvtQsQ7Fv8p3ko+Ak4BssOQuTp4c2US/wMmZHD4A9TChHia83ktW9mFFH9YskDngEsgG6CaAphvRdKMJxAeg9OEYQAO5N4D+xy95YZkBsh7m8/JioAXQJi2kxwMO41mAlNb7ApSuYK6TqYGYA4q+IuGL/AOyIGe03hywOT4xQOzB4pZbAEBEmEOFOVTfMeTULh4J4HoNxBeA86i1EhoDaCDmgF0Ip2x57Jyi3hfgA/gQyhA4pWHwAAAAAElFTkSuQmCC");
  }
  .player.right4 {
    background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAuUlEQVRYhd3UsQ2AIBAF0CupbCwcxMIN3MA4iONYsY+V61h8K2KCoHBgOLzkOvFejvCJrkLmji4ZgGZa0Uwr2mVn9agPjPpggYoDPoE4QJUAumFGN8xFIDIAqYN9gBBI3QC6P7/owCoGYA0239s/BnoAfVQg/R7wWv8CxKxeFiA1gs05u0MgxQHOq0iN5CoBrCvJsXqZgE0rbFoFDybG86sL4Ft1jpXLBpim+4rZ0Sse4IT4YA9Q2YAT8xk+1FRiFvEAAAAASUVORK5CYII=");
  }
  .player.right5 {
    background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAwUlEQVRYhd3UMRJAMBAF0JQqjcJBFG6QGxgHcRxV7qNyHcVXZYxIyGaZrOzMdvgvllXqKLzc5JIBqIcZ9TCjmdak1maDNlsSKDvgE4gH9BNA249o+zELRAaAGxwCxED+DVDX34+8sLIBkoLt9e6DgQ5AR1pIxQMeqywA5dXLAnBXsL3P7RhIdoB3FKFmjEg+wDsSt58gnGAxgBNkMRUWU0UHFwE4LRILcCE3geRFJAbg/fhCENuck8oERASxZywCsAMdyD0A7H950gAAAABJRU5ErkJggg==");
  }
  .player.right6 {
    background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAz0lEQVRYhd3Uuw2EMAwG4JRUNBQMQsEGbIAY5Mahyj5Utw7FT2Wd8AHOgzs7RHKDkvgTju3cZ+HmiF42APU4ox5nNK93Ugx+xeDXJJA64CeQA1AhgLaf0PaTCsQGIDfxGSAEUjbAfbdf9MBSAyQlpv38YqAD0EUNpMcDxPUsQMyvtwXIHcF0jkcIRB2QVYqIEtkH3ALJSawO2D1GDpFAF21pH3DYhvxCqU3pO+1bfIXFV+lz4B+A3cVnAF4SCUKJywHwA1I49sgC9l3XXguwAQli06wHatHeAAAAAElFTkSuQmCC");
  }
  .player.right7 {
    background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAy0lEQVRYhd3UMQ6DMAwFUI9MLB04CAM34AaIg/Q4TLkPU6/D8Du5ldwG4iTIBktekEOe4jhE30DlVIcPQDstaKcFj+crK8ewYQxbFsgccArkD+gigG6Y0Q2zCcQHoHTjGCAFcm0A/Y6f+sEyA2RtzPXyx0APoFc9SLcHHMa9AJqj9wUofYJ5ncwUiDmgqBWKFvkHVIGUbGwG2B0jealOO3ILAIgIa2iwhuYzhnIcue5oTPk716VAfAFiENmSmhBzwC6EUwJidQnrfQHe2ZzLvHbrqHwAAAAASUVORK5CYII=");
  }
  .player.right8 {
    background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAArklEQVRYhe3UMQ6AIAwFUEYnFwcO4uANvAHxIB7Hifs4eR2G70SMqMEChkJs0oUU+gKhQhyBxEkOHoBWLWjVgm7egnLUBqM2QaDsgE8gN6BCAHKYIIcpC4QHILbxE+ANpGyAuH4/8sDKBghqbOvdg4EeQE8aSNUDvFEXgHL1vACxI9juc/MNJDsg6ikIT8QfkAQS05gXgApJ0ZgnwPc97bqt+wFVAE6QVTekLAawAxlDXCSqTs7FAAAAAElFTkSuQmCC");
  }


/// anmother

  .player.right1 {
    background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAv0lEQVRYheXVPQ6DMAwF4IydWBg4CAN7h5ygiINwHKbch4nrMLxOUYv5CU5SnFBLb4qFPwVhlPoUIoddaQCKdkDRDij7ySvazNBm9gKJA34C2QBlAqiaDlXTiUDSAIQO3gOcgeQNUOvPj72wxABeg20/fTBQA6hZC+n2AGelBeBm46rD/oZiALuC6SqmoX2u/jMQccBheSykuCUOcIH2XonN/QHc8/wAr6fCd0bzWISe/x8geEDyAFoUcDkoFuAN0leqeQCqGSoAAAAASUVORK5CYII=");
  }
  .player.right2 {
    background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAuElEQVRYhd3VIQ6AMAwF0EkUBsFBEHgEJ4BwEI6D2n1QXAfxUQtJgY2OkW5r8tUa+jJCUeosBA674gCU44JyXFDNm1d6vaPXuxdIHPAL5AaUCKBuJ9TtJAKJA/B18BPgDSRtgLp+fuyFJQbwGmz66YOBBkDDWkjZA5wVF4Cbm6v+9jcUA5gVTFcxDe1z9b+BiAOs5bGQwpY4wAV6eiUm+QO45+kBVl3AlqFT1uQHoOfBB0YPcIGSARxyRathmNKS5gAAAABJRU5ErkJggg==");
  }
  .player.right3 {
    background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAuUlEQVRYhd3VsQ2AIBAFUEorGwsGsXADNzAO4jhW7GPlOhTfipggigfIgZf8DuSFC6cQZyFxyFUGoJ1WtNOKbtmDMiqNUekgEDvgE4gDVAlADjPkMLNAygDEHnwHeAOpGyCuz488sNgAQQeb9faHgR5ATxpIvwd4qywANY6rjvsbsgHMCLZHsR17nW/9Gwg74LECBlLaYgf4QHctMakfQL3y5C3JDthUg6dQ99cPyL2/PEBsC8igXIAD76zmoV4IPxoAAAAASUVORK5CYII=");
  }
  .player.right4 {
    background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAu0lEQVRYhd3VsQ2EMAwF0JRX0VAwCAUbsAFikBuHKvtQsU6KT4U4+QBjE3CIJVdY8ZMhxrk1EDnFkQag6AYU3YDyO6my9QGtDyqQOeAWyAboJYCq6VE1vQkkDcDVxnuAM5B3A9z/9RMvLDOAqvFSTw8GagC1aCFlD2AjLYA0N0Z97W9oBlhWMF3FNGkdV38GYg44DMVCihvmAA5EX0V+AG7k+QFG/8Fvch8Zrc8PELs+fYC0AX3++ES0gBkLwb9hwkhK7AAAAABJRU5ErkJggg==");
  }
  .player.right5 {
    background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAuklEQVRYhd3VORJAQBAF0AlFEoGDCOQCJ6AcxHFEcx+R6wi+SCltGbPQPX7Vz6b0K0tTagsC1zoyAGk7IG0HZP3k1FrPqPXsBGIHvAI5AUUCyMsOedmxQGQAfAdfAZ5A4gao4+dnvbDYAE6D1/P0wkABoLBaSL8HGCMLYNuTW+33N2QDrCuYrmJaes50/gmEHXAbh4UUNuwAcSB2AH35TMD4AaNOcNfXH4E4QFOpXb0HiAfQUMDnoFCABXm2rynfj+HxAAAAAElFTkSuQmCC");
  }
  .player.right6 {
    background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAuElEQVRYhd3VIQ6AMAwF0EkUBsFBEHgEJ4BwEI6D2n1QXAfxUYSkwMbGoN2afLWGvixZUeooBI5zyQDk/YS8n1CMi1davaLVqxeIHfAJ5AIUCaCsB5T1wAKRAXg7+A7wBBI3QJ2fn/PCYgN4Dd776YeBCkDltJCSB1hLFsA1F1f97m/IBthXMF3FNLTP1v8Ewg4wlsdCClvsAFr06n8HiQPQ8/QAXaNgyqwzY9ID0PPgA8UDbKBoABvoM51xOITh1QAAAABJRU5ErkJggg==");
  }
  .player.right7 {
    background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAuklEQVRYhd3VvQ2AIBAFYEorGwsGsXADNzAM4jhW7GPlOhTPypicP3igHPiS6w74AvFUag9eLnbyANTDhHqY0IxLUPXWobcuCCQO+ARyAioEoDsD3RkRSB6A2IOvAE8gZQPU8fNjDywxQNDBWz/dGGgBtKyB9HuAN3kBuHVy1XF/QzHANoLpKKZF+3z9TyDigNsEDKR3Iw6goVefHJQcQDekAF9/eYDZVrgr7vryAanX5weIfQI2KBVgBYan5qFn5gb1AAAAAElFTkSuQmCC");
  }
  .player.right8 {
    background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAuUlEQVRYhd3VsQ2EMAwF0JRX0VAwCAUbsAFikBuHKvtcdetQfCrE6R8QbAIO+ZIrLPxkCePcEkQucdIAFN2AohtQvr+qav2I1o8qkDngEsgK6CGAqulRNb0JJA3A2cFbgCOQZwPc/+cnPlhmANXguZ9fDNQAatFByh4QTFoAaa2s+tzf0Awwn2A+xVzcF+o/AjEH7EZxkOLGHMDh1ecP4AH5Az7+hd8KDeD+/ACx+9MHSAfw89s3ogVMWLK/YZqNNL8AAAAASUVORK5CYII=");
  }
*/

  function createMonster(type) {
    var template = monsters[type];
    var monster = {
      setHp: template.setHp,
      setMana: template.setMana,
      name: template.name,
      hp: template.hp,
      sprite: template.sprite,
      speed: template.speed,
      mana: template.mana,
      abilities: template.abilities,
      x: 0,
      y: 0,
      xOffset: 0,
      yOffset: 0
    };

    var playerX = player.x;
    var playerY = player.y;
    var playerElement = player.element;

    var startingPosition = getRandomInt(1, 4);

    for (var i = 0; i < 4; i++) {
      if (startingPosition === 1) { // top
        if (data[playerY-1][playerX] === " ") {
          monster.x = playerX;
          monster.y = playerY-1;
          monster.yOffset = -1;
          playerElement.className = "player";
          playerElement.classList.add("up1");
          break;
        } else {
          startingPosition++;
        }
      } else if (startingPosition === 2) { // right
        if (data[playerY][playerX+1] === " ") {
          monster.x = playerX+1;
          monster.y = playerY;
          monster.xOffset = 1;
          playerElement.className = "player";
          playerElement.classList.add("right1");
          break;
        } else {
          startingPosition++;
        }
      } else if (startingPosition === 3) { // bottom
        if (data[playerY+1][playerX] === " ") {
          monster.x = playerX;
          monster.y = playerY+1;
          monster.yOffset = 1;
          playerElement.className = "player";
          playerElement.classList.add("down1");
          break;
        } else {
          startingPosition++;
        }
      } else if (startingPosition === 4) { // left
        if (data[playerY][playerX-1] === " ") {
          monster.x = playerX-1;
          monster.y = playerY;
          monster.xOffset = -1;
          playerElement.className = "player";
          playerElement.classList.add("left1");
          break;
        } else {
          startingPosition = 1;
        }
      }
    }

    return monster;
  }
  monsters = {
    "Wild Skeleton": {
      name: "Wild Skeleton",
      hp: 10,
      sprite: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAA1UlEQVRYhe2V3Q2DMAyEb0SmyBYskXHYAjFAN4AR3CdXtRvnp40aN+pJfiCOL5/QEYB6UWN11zAAAkBLCLSEQLfzqqqeID4A2JhBLM0PUNIfYCoAAvAwfjIU66X+JyA+ABKvVKyX+vMA6BDqA3UIpwAQIBqo4vPrew98E0AYbPtB236Y4dO/aWuuBWgYgBhcY6Q1RjN0pWKxTwLID0D2auXBVukDLX//ALrPzxw+LmvfTwCILGRSSgBewsni9dJ8pj8ewFLyYG3YANKsYQDV4Xlzvw+AOzMfFFe+DYz4AAAAAElFTkSuQmCC",
      setHp: function(hp) {
        this.hp = hp;
      },
      setMana: function(mana) {
        this.mana = mana;
      },
      speed: 3,
      mana: 0,
      abilities: ["shank"]
    },
    "Gruesome Eye": {
      name: "Gruesome Eye",
      hp: 10,
      sprite: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAA+0lEQVRYhd2X2w2DMAxF73eX6UDMUXUHdmCc7NIt3I82KLn4kUqVHLDkHwg5B9uAwOt+kzY3QDZAYIcEGYUA2HlIF+ANmhNqllLcjASbG9yF0wW60vACBkRhCXGrpxToREaBo0JKO/wpvbJAGGkCQ2CllALgLyK5AgsgiyPAwLWIrD906DoCFWyV3jp+HoH6qhwVcI5/Jvsbyue+F0kXiEQsoCXE4LrvCQUezy4ZdADTehYIP8fpAvUEX2AJWUAGO9LzCAgaYB2WhZIBFrABD8ccAtFjwgDOer0zbH4LMgS60itDEwmqrVNA3br5BLh01i9aVFprH681qQJvKnNb0k26qPQAAAAASUVORK5CYII=",
      setHp: function(hp) {
        this.hp = hp;
      },
      setMana: function(mana) {
        this.mana = mana;
      },
      speed: 3,
      mana: 0,
      abilities: ["gruesome stare"]
    }
  }

  var player = {
    name: "Manannan",
    element: document.createElement("span"),
    x: 0,
    y: 0,
    hp: 10,
    setHp: function(hp) {
      this.hp = hp;
      document.querySelector(".player-health").textContent = hp;
    },
    setMana: function(mana) {
      this.mana = mana;
      document.querySelector(".player-mana").textContent = mana;
    },
    speed: 2,
    mana: 10,
    abilities: [
      "melee", "fireball", "heal"
    ]
  };

  function createBoard(gameBoard, sprites, height, width) {
    var container = document.querySelector(".container");
    var boardContainer = document.createElement("div");
    boardContainer.classList.add("board-container");
    boardContainer.style.height = height * 32 + "px";
    boardContainer.style.width = width * 32 + "px";
    var row;
    var col;
    for (var y = 0; y < height; y++) {
      row = document.createElement("div");
      row.classList.add("row");
      data[y] = [];
      for (var x = 0; x < width; x++) {
        col = document.createElement("span");
        if (sprites[gameBoard[y][x]].collision) {
          data[y][x] = "x";
        } else {
          data[y][x] = " ";
        }
        col.style.backgroundImage = 'url("' + sprites[gameBoard[y][x]].data + '")';
        col.classList.add("col");
        row.appendChild(col);
      }
      boardContainer.appendChild(row);
    }
    container.appendChild(boardContainer);
  }

  function getRandomInt(min, max) {
    max++;
    return Math.floor(Math.random() * (max - min)) + min;
  }

  function getTile(x, y) {
    return data[y][x];
  }

  dialogFocus = [];

  function createDialog() {
    var container = document.querySelector(".dialog-container");
    var dialogElement = document.createElement("div");
    dialogElement.classList.add("dialog");
    container.appendChild(dialogElement);
    var dialog = {
      close: function() {
        container.removeChild(dialogElement);
      },
      setText: function(text) {
        dialogElement.textContent = text;
      }
    };
    return dialog;
  }

  function createMenu(items, container, className) {
    container = container || document.querySelector(".dialog-container");
    var menuContainer = document.createElement("div");
    menuContainer.classList.add("dialog");
    if (className) {
      menuContainer.classList.add(className);
    }
    var item;
    var itemElements = [];
    for (var i = 0; i < items.length; i++) {
      item = document.createElement("div");
      item.textContent = items[i];
      itemElements.push(item);
      menuContainer.appendChild(item);
    }
    itemElements[0].classList.add("menu-item-selected");
    container.appendChild(menuContainer);
    var selectedIndex = 0;
    var menu = {
      up: function() {
        if (selectedIndex === 0) {
          return;
        }
        itemElements[selectedIndex].classList.remove("menu-item-selected");
        selectedIndex--;
        itemElements[selectedIndex].classList.add("menu-item-selected");
      },
      down: function() {
        if (selectedIndex === items.length-1) {
          return;
        }
        itemElements[selectedIndex].classList.remove("menu-item-selected");
        selectedIndex++;
        itemElements[selectedIndex].classList.add("menu-item-selected");
      },
      getSelected: function() {
        return items[selectedIndex];
      },
      close: function() {
        container.removeChild(menuContainer);
      }
    };
    return menu;
  }

  function simpleDialog(textArray, callback) {
    if (typeof textArray === "string") {
      textArray = [textArray];
    }
    if (!textArray.length) {
      return;
    }
    function processLine(text) {
      var dialog = createDialog();
      dialog.setText(text);
      dialogFocus.push(function(key) {
        if (key === "Enter") {
          dialog.close();
          dialogFocus.pop();
          if (textArray.length) {
            processLine(textArray.shift());
          } else {
            callback && callback();
          }
        }
      });
    }
    processLine(textArray.shift());
  }

  function simpleMenu(items, callback) {
    var menu = createMenu(items, document.querySelector(".player-status-container"), "player-battle-menu");
    dialogFocus.push(function(key) {
      if (key === "Down") {
        menu.down();
      } else if (key === "Up") {
        menu.up();
      } else if (key === "Enter") {
        menu.close();
        dialogFocus.pop();
        callback && callback(menu.getSelected());
      }
    });
  }

  function timedDialog(text, time) {

    var dialog = createDialog();
    dialog.setText(text);
    setTimeout(function() {
      dialog.close();
    }, time || 5000);
  }

  function createBattle(monster) {

    dialogFocus.push(function(key) {});
    simpleDialog("A " + monster.name + " appears");
    var playerStatus = document.querySelector(".player-status-container");
    playerStatus.classList.remove("hidden");
    var container = document.querySelector(".container");
    var monsterDiv = document.createElement("div");
    monsterDiv.classList.add("monster");
    monsterDiv.style.backgroundImage = 'url("' + monster.sprite + '")';
    monsterDiv.style.marginLeft = (monster.xOffset * 32) - 16 + "px";
    monsterDiv.style.marginTop = (monster.yOffset * 32) - 16 + "px";
    container.appendChild(monsterDiv);

    function startCooldownTimer(update, finished, cooldown) {
      var lastTime = Date.now();
      var timePassed = 0;
      function timeUpdate() {

        if (dialogFocus.length > 1) {
          lastTime = Date.now();
          setTimeout(timeUpdate);
        } else {
          var nowTime = Date.now();

          timePassed += (nowTime - lastTime)/1000;
          update(timePassed);
          if (timePassed >= cooldown) {
            finished();
          } else {
            lastTime = Date.now();
            setTimeout(timeUpdate);
          }
        }
      }
      timeUpdate();
    }

    function attack(attacker, victim, action, callback, victory) {
      victory = victory || function() {};
      var ability = abilities[action];
      if (attacker.mana >= ability.cost) {
        attacker.setMana(attacker.mana - ability.cost);
        victim.setHp(victim.hp - ability.damage);
      }
      if (victim.hp <= 0) {
        simpleDialog([attacker.name + " hits " + victim.name + " with " + action + " for " + ability.damage + " damage", victim.name + " has been slain by " + attacker.name], victory);
      } else {
        simpleDialog(attacker.name + " hits " + victim.name + " with " + action + " for " + ability.damage + " damage");
        callback();
      }
    }

    var playerCooldownElement = document.querySelector(".player-cooldown");
    function playerCooldown() {
      startCooldownTimer(function(diff) {
        playerCooldownElement.style.width = (diff/player.speed*100) + "%";
      }, function() {
        if (player.hp <= 0) {
          return;
        }
        simpleMenu(player.abilities, function(action) {
          playerCooldownElement.style.width = "0";
          attack(player, monster, action, playerCooldown, function() {
            container.removeChild(monsterDiv);
            playerStatus.classList.add("hidden");
            dialogFocus.pop();
          });
        });

      }, player.speed);
    }
    playerCooldown();

    function monsterCooldown() {
      startCooldownTimer(function() {

      }, function() {
        if (monster.hp <= 0) {
          return;
        }
        attack(monster, player, monster.abilities[0], monsterCooldown);
      }, monster.speed);
    }
    monsterCooldown();
  }

  function rollForBattle(chance) {
    var roll = getRandomInt(1, 100);
    if (roll <= chance) {
      var monsterList = Object.keys(monsters);
      var monsterRoll = getRandomInt(1, monsterList.length);
      var monster = monsterList[monsterRoll-1];
      createBattle(createMonster(monster));
    }
  }

  var chance = 0;
  var playerKeys = {};
  var key = "";
  function processKeys() {
    if (dialogFocus.length) {
      dialogFocus[dialogFocus.length-1](key);
      key = "";
      setTimeout(processKeys);
    } else if (playerKeys["Right"]) {
      movePlayer("right", 1, 0);
    } else if (playerKeys["Left"]) {
      movePlayer("left", -1, 0);
    } else if (playerKeys["Down"]) {
      movePlayer("down", 0, 1);
    } else if (playerKeys["Up"]) {
      movePlayer("up", 0, -1);
    } else {
      setTimeout(processKeys);
    }
  }
  processKeys();
  var keyframe = "0";
  function movePlayer(direction, x, y) {

    var playerElement = player.element;
    var boardContainer = document.querySelector(".board-container");
    var steps = 0;
    var xSteps = 0;
    var ySteps = 0;
    var speed = 8;
    function step() {
      steps+=speed;
      if (steps > 32) {
        player.y+=y;
        player.x+=x;
        dialogFocus.pop();
        rollForBattle(chance);
        setTimeout(processKeys);
        if (keyframe === "0") {
          keyframe = "-32px"
        } else {
          keyframe = "0";
        }
      } else {
        //if (playerElement.classList.contains(direction + "1")) {
        //  playerElement.className = "player";
        //  playerElement.classList.add(direction + "2");
        playerElement.className = "player";
        if (direction === "left") {
          playerElement.classList.add("flip");
          //playerElement.classList.add("right" + (steps / speed));
          playerElement.style.backgroundPosition = -32 * ((steps / speed)-1) + "px " + keyframe;
        } else if (direction === "right") {
          playerElement.style.backgroundPosition = -32 * ((steps / speed)-1) + "px " + keyframe;
          //playerElement.classList.add("right" + (steps / speed));
        } else if (direction === "down") {
          //playerElement.classList.add("down1");
          if ((steps / speed) !== 1) {
          //  playerElement.classList.add("flip");
          }
        } else if (direction === "up") {
          //playerElement.classList.add("up1");
          if ((steps / speed) !== 1) {
          //  playerElement.classList.add("flip");
          }
        }
        //} else {
        //  playerElement.className = "player";
        //  playerElement.classList.add(direction + "1");
        //}
        xSteps+=((-x)*speed);
        ySteps+=((-y)*speed);
        boardContainer.style.marginLeft = (-player.x * 32) + xSteps - 16 + "px";
        boardContainer.style.marginTop = (-player.y * 32) + ySteps - 16 + "px";
        setTimeout(step, 100);
      }
    }
    if (getTile(player.x+x, player.y+y) !== "x") {
      dialogFocus.push(function(key) {});
      step();
    } else {
      if (!playerElement.className.contains(direction)) {
        playerElement.className = "player";
        playerElement.classList.add(direction + "1");
      }
      setTimeout(processKeys);
    }
  }

  function onGameKeydown(e) {
    key = e.key;
    playerKeys[e.key] = true;
  }

  function onGameKeyup(e) {
    key = "";
    playerKeys[e.key] = false;
  }

  function createPlayer(x, y) {
    var playerElement = player.element;
    //playerElement.classList.add("down1");
    var container = document.querySelector(".container");
    var boardContainer = document.querySelector(".board-container");
    playerElement.classList.add("player");
    container.appendChild(playerElement);
    player.x = x;
    player.y = y;
    boardContainer.style.marginLeft = (-x * 32) - 16 + "px";
    boardContainer.style.marginTop = (-y * 32) - 16 + "px";
    document.addEventListener("keydown", onGameKeydown, false);
    document.addEventListener("keyup", onGameKeyup, false);
    var playerHealthElement = document.querySelector(".player-health");
    playerHealthElement.textContent = player.hp;
    var playerManaElement = document.querySelector(".player-mana");
    playerManaElement.textContent = player.mana;
    var playerStatusContainer = document.querySelector(".player-status-container");
  }

  function generateMapList() {
    var TestObject = Parse.Object.extend("SavedMapsTest");
    var query = new Parse.Query(TestObject);
    query.find({
      success: function(results) {
        console.log("Successfully retrieved " + results.length + " maps.");
        // Do something with the returned Parse.Object values
        results.reverse();
        var mapList = document.querySelector(".map-list");
        var mapListContainer = document.querySelector(".map-list-container");
        mapList.innerHTML = "";
        results.forEach(function(object) {
          var mapItem = document.createElement("div");
          mapItem.classList.add("map-item");
          mapItem.textContent = object.get("name");
          mapList.appendChild(mapItem);
          mapItem.addEventListener("click", function() {

            var localeSprites = object.get("sprites");
            var gameBoardArray = object.get("gameBoard");
            var height = object.get("height");
            var width = object.get("width");
            chance = object.get("battleChance");
            mapListContainer.innerHTML = "";
            createBoard(gameBoardArray, localeSprites, height, width);
            createPlayer(1, 1);
          });
        });
      },
      error: function(error) {
        console.log("Error: " + error.code + " " + error.message);
      }
    });
  }
  generateMapList();

</script>
